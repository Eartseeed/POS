<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡ªÄ‡∫°‡∫ô‡∫π</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<h2> üí± ‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡ªÄ‡∫°‡∫ô‡∫π</h2>

<!-- ‡πÅ‡∏ñ‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° -->
<div style="padding:12px; display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
  <button onclick="location.href='index.html'">‚¨Ö ‡∫Å‡∫±‡∫ö‡ªÑ‡∫õ‡ªú‡ªâ‡∫≤‡∫Ç‡∫≤‡∫ç</button>

  <div style="background:white;padding:8px 12px;border-radius:8px;">
    üí± ‡∫õ‡∫±‡∫ö‡ªÄ‡∫•‡∫î‡ªÄ‡∫á‡∫µ‡∫ô:
    1 ‡∏ö‡∏≤‡∏ó =
    <input id="rateInput" type="number" style="width:90px;"> ‡∫Å‡∫µ‡∫ö
    <button onclick="saveRate()">‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å</button>
  </div>
</div>

<div class="menu" id="manageMenu"></div>

<script>
/* ==========================
   ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏ó‡πÄ‡∏á‡∏¥‡∏ô (default 680)
========================== */
let RATE_KIP = parseFloat(localStorage.getItem("RATE_KIP")) || 680;
document.getElementById("rateInput").value = RATE_KIP;

let products = JSON.parse(localStorage.getItem("products") || "[]");

/* ==========================
   ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π
========================== */
function renderManage(){
  const box = document.getElementById("manageMenu");
  box.innerHTML = "";

  products.forEach((p,index)=>{
    const kip = p.price * RATE_KIP;

    box.innerHTML += `
      <div class="item">

        <div class="photo">
          <img src="${p.img}">
        </div>

        <!-- ‡∫õ‡ªà‡∫Ω‡∫ô‡∫Æ‡∫π‡∫ö -->
        <input type="file" accept="image/*"
          onchange="changeImage(${index}, this)"
          style="margin:6px 0; font-size:12px;">

        <!-- ‡ªÅ‡∫Å‡ªâ‡∫ä‡∫∑‡ªà -->
        <b contenteditable="true"
           onblur="update(${index}, 'name', this.innerText)">
           ${p.name}
        </b>

        <!-- ‡ªÅ‡∫Å‡ªâ‡∫•‡∫≤‡∫Ñ‡∫≤ -->
        <div contenteditable="true"
             onblur="update(${index}, 'price', this.innerText)">
          ‡∏ø ${p.price} ‡∏ö‡∏≤‡∏ó
        </div>

        <!-- ‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫Å‡∫µ‡∫ö -->
        <small style="color:#555;">
          = ${kip.toLocaleString()} ‡∫Å‡∫µ‡∫ö
        </small>

        <!-- ‡∫•‡∫ª‡∫ö -->
        <button onclick="removeProduct(${index})"
          style="margin-top:auto;
                 background:#ef4444;
                 color:white;
                 border:none;
                 padding:6px;
                 border-radius:6px;
                 cursor:pointer;">
          üóë ‡∫•‡∫ª‡∫ö‡ªÄ‡∫°‡∫ô‡∫π
        </button>

      </div>
    `;
  });
}

/* ==========================
   ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏ó‡πÄ‡∏á‡∏¥‡∏ô
========================== */
function saveRate(){
  const val = parseFloat(document.getElementById("rateInput").value);
  if(val <= 0){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏£‡∏ó‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
    return;
  }

  RATE_KIP = val;
  localStorage.setItem("RATE_KIP", RATE_KIP);
  renderManage();
}

/* ==========================
   ‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠ / ‡∏£‡∏≤‡∏Ñ‡∏≤
========================== */
function update(index, key, value){
  if(key === "price") {
    value = parseFloat(value.replace(/[^\d]/g,'')) || 0;
  }

  products[index][key] = value;
  save();
  renderManage();
}

/* ==========================
   ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ
========================== */
function changeImage(index, input){
  const file = input.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = e => {
    products[index].img = e.target.result;
    save();
    renderManage();
  };
  reader.readAsDataURL(file);
}

/* ==========================
   ‡∏•‡∏ö‡πÄ‡∏°‡∏ô‡∏π
========================== */
function removeProduct(index){
  if(!confirm("‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫•‡∫ª‡∫ö‡ªÄ‡∫°‡∫ô‡∫π‡∫ô‡∫µ‡ªâ‡∫ö‡ªç?")) return;

  products.splice(index,1);
  save();
  renderManage();
}

/* ==========================
   ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
========================== */
function save(){
  localStorage.setItem("products", JSON.stringify(products));
}

/* ==========================
   ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
========================== */
renderManage();
</script>

</body>
</html>