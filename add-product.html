<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>โ เปเบเบตเปเบกเปเบกเบเบน</title>

<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="Phetsarath OT.css">
</head>

<body>

<h2>โ เปเบเบตเปเบกเปเบกเบเบนเบชเบดเบเบเปเบฒ</h2>

<div class="admin-container">

  <div class="admin-card">
    <div class="admin-title">๐ เบเปเปเบกเบนเบเปเบกเบเบน</div>

    <!-- FORM -->
    <div class="form-grid">
      <!-- NAME -->
      <input id="pname" placeholder="เบเบทเปเบชเบดเบเบเปเบฒ">

      <!-- BARCODE (SCAN READY) -->
      <input 
        id="pbarcode"
        placeholder="๐ท Scan Barcode"
        inputmode="numeric"
        autocomplete="off"
        onfocus="this.select()"
        oninput="this.value=this.value.replace(/[^0-9]/g,'')"
        onkeyup="barcodeEnter(event)">

      <!-- PRICE (KIP) -->
      <input id="pprice" type="number" placeholder="เบฅเบฒเบเบฒ (เบเบตเบ)">

      <!-- STOCK -->
      <input id="pstock" type="number" placeholder="๐ฆ เบเบณเบเบงเบ Stock">

      <!-- CATEGORY (INPUT) -->
      <input id="pcategory" placeholder="๐ เปเบงเบเบชเบดเบเบเปเบฒ">

      <!-- IMAGE -->
      <input type="file" id="pimg" accept="image/*">
    </div>

    <!-- BUTTON -->
    <div style="margin-top:16px; display:flex; gap:12px;">
      <button class="btn-main" onclick="addProduct()">๐พ เบเบฑเบเบเบถเบ</button>
      <button class="btn-back" onclick="location.href='index.html'">โฌ เบเบฑเบ</button>
    </div>

  </div>

</div>

<script>
/* =====================
   BARCODE ENTER SUPPORT
===================== */
function barcodeEnter(e){
  if(e.key === "Enter"){
    addProduct();
  }
}

/* =====================
   ADD PRODUCT
===================== */
function addProduct() {
  const name     = document.getElementById("pname").value.trim();
  const barcode  = document.getElementById("pbarcode").value.trim();
  const price    = Number(document.getElementById("pprice").value);
  const stock    = Number(document.getElementById("pstock").value);
  const category = document.getElementById("pcategory").value.trim();
  const file     = document.getElementById("pimg").files[0];

  if (!name || !barcode || !price || !file || isNaN(stock)) {
    alert("โ เบเบฐเบฅเบธเบเบฒเบเปเบญเบเบเปเปเบกเบนเบเปเบซเปเบเบปเบ");
    return;
  }

  if(!/^[0-9]+$/.test(barcode)){
    alert("โ Barcode เบเปเบญเบเปเบเบฑเบเบเบปเบงเปเบฅเบ");
    return;
  }

  let products = JSON.parse(localStorage.getItem("products") || "[]");

  // โ Prevent duplicate barcode
  if(products.some(p => p.barcode === barcode)){
    alert("โ Barcode เบเบตเปเบเบทเบเปเบเปเปเบฅเปเบง");
    return;
  }

  const reader = new FileReader();
  reader.onload = e => {
    products.push({
      name,
      barcode,
      price,        // KIP
      img: e.target.result,
      category,
      stockIn: stock,
      sold: 0
    });

    localStorage.setItem("products", JSON.stringify(products));
    alert("โ เบเบฑเบเบเบถเบเบชเบณเปเบฅเบฑเบ");

    // Clear form
    pname.value = "";
    pbarcode.value = "";
    pprice.value = "";
    pstock.value = "";
    pcategory.value = "";
    pimg.value = "";
  };

  reader.readAsDataURL(file);
}
</script>

</body>
</html>